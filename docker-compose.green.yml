version: '3'
services:
  green-app:
    container_name: green-app-service
    build:
      context: ./server
      dockerfile: Dockerfile
    ports:
      - "3002:3000"
    networks:
      - default

  frontend:
    container_name: green-frontend
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_URL: http://green-app-service:3000
    ports:
      - "8082:80"
    networks:
      - default

networks:
  default:
    external:
      name: saas-network

steps:
  - name: Create External Network if Not Exists
    run: |
      docker network inspect saas-network >/dev/null 2>&1 || docker network create saas-network

  - name: 🐳 Run Docker Compose
    run: docker-compose -f docker-compose.green.yml up -d --build
