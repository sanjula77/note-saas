# name: ğŸš€ Deploy to Environment

# on:
#   push:
#     branches:
#       - dev
#       - staging
#       - main

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     # Dynamically set environment based on branch name
#     environment: >
#       ${{
#         github.ref == 'refs/heads/main' && 'production' ||
#         github.ref == 'refs/heads/staging' && 'staging' ||
#         'development'
#       }}

#     steps:
#       - name: â¬‡ï¸ Checkout code
#         uses: actions/checkout@v3

#       - name: ğŸŸ¢ Setup Node.js
#         uses: actions/setup-node@v3
#         with:
#           node-version: '18'

#       - name: ğŸ“¦ Install Backend Dependencies
#         run: npm install
#         working-directory: ./server

#       - name: ğŸ“¦ Install Frontend Dependencies
#         run: npm install
#         working-directory: ./frontend

#       - name: ğŸ› ï¸ Build Frontend
#         run: npm run build
#         working-directory: ./frontend

#       - name: ğŸš€ Deploy to ${{ github.ref_name }} environment
#         run: |
#           echo "âœ… Deployment started for: ${{ github.ref_name }}"
#           echo "You can put your actual deploy steps here."
#           # Examples:
#           # scp -r ./dist user@yourserver:/var/www/your-app
#           # or docker build/push
#           # or firebase deploy
#           echo "ğŸŒ Environment: ${{ github.ref_name }}"
#         env:
#           DB_URL: ${{ secrets.DB_URL }}
#           VITE_API_URL: ${{ secrets.VITE_API_URL }}
#           NODE_ENV: ${{ secrets.NODE_ENV }}
name: ğŸš€ Deploy to Environment

on:
  push:
    branches:
      - dev
      - staging
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    # Dynamically set the environment name based on the branch
    environment: >
      ${{
        github.ref == 'refs/heads/main' && 'production' ||
        github.ref == 'refs/heads/staging' && 'staging' ||
        'development'
      }}

    steps:
      - name: â¬‡ï¸ Checkout Code
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ“¦ Install Backend Dependencies
        run: npm install
        working-directory: ./server

      - name: ğŸ“¦ Install Frontend Dependencies
        run: npm install
        working-directory: ./frontend

      - name: ğŸ› ï¸ Build Frontend
        run: npm run build
        working-directory: ./frontend

      - name: ğŸ§ª Print Environment Info
        run: |
          echo "âœ… Branch: ${{ github.ref_name }}"
          echo "ğŸŒ Environment: $NODE_ENV"
          echo "ğŸ”— Database URL: $DB_URL"
          echo "ğŸŒ API URL (Frontend): $VITE_API_URL"
        env:
          DB_URL: ${{ secrets.DB_URL }}
          VITE_API_URL: ${{ secrets.VITE_API_URL }}
          NODE_ENV: ${{ secrets.NODE_ENV }}

      - name: ğŸš€ Deploy to ${{ github.ref_name }} environment
        run: |
          echo "ğŸš§ Placeholder for your actual deployment script"
          echo "â¡ï¸ For example, run SCP, SSH, Docker push, Firebase deploy, etc."
          echo "âœ”ï¸ Deployment complete for ${{ github.ref_name }}."
        env:
          DB_URL: ${{ secrets.DB_URL }}
          VITE_API_URL: ${{ secrets.VITE_API_URL }}
          NODE_ENV: ${{ secrets.NODE_ENV }}
